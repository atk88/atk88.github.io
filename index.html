<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMTV多螢幕播放</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background: linear-gradient(145deg, #0d0d0d, #1a1a1a, #0d0d0d); /* 漸變背景 */
            color: #0055FF; /* 文字顏色設為#0055FF */
            font-family: 'Roboto Mono', monospace; /* 使用Roboto Mono字體 */
        }

        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            background: linear-gradient(145deg, #0d0d0d, #1a1a1a, #0d0d0d);
            opacity: 0;
            transition: opacity 0.5s ease-in;
            background-size: 200% 200%;
            animation: backgroundAnimation 10s ease infinite;
        }

        .controls-container {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(13, 13, 13, 0.8);
            padding: 10px;
            z-index: 1000;
            position: sticky;
            top: 0;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 10px;
            max-width: 1000px; /* 增加最大寬度 */
            width: 100%;
        }

        .controls input, .controls button {
            padding: 5px 10px;
            font-size: 14px;
            background-color: #1a1a1a;
            color: #0055FF;
            border: 1px solid #0055FF;
            border-radius: 4px;
            transition: background-color 1.5s ease, transform 0.1s ease;
        }

        .controls input[type="number"] {
            width: 60px;
        }

        .controls input[type="text"] {
            flex-grow: 1;
            min-width: 150px;
        }

        .controls input:hover, .controls button:hover {
            background-color: #0055FF;
            color: #1a1a1a;
        }

        .controls input:active, .controls button:active {
            transform: scale(0.95);
        }

        .logo {
            position: fixed;
            top: 10px;
            right: 10px; /* 大尺寸螢幕時在右邊 */
            z-index: 1100;
        }

        .logo img {
            height: 30px;
            filter: brightness(1.2);
        }

        .video-container {
            flex-grow: 1;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 5px;
            padding: 5px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 寬高比 */
            height: 0;
            overflow: hidden;
            transition: box-shadow 0.3s ease;
        }

        .video-wrapper:hover {
            box-shadow: 0 0 15px rgba(85, 159, 216, 0.7);
        }

        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .controls-container {
                padding: 5px;
                flex-direction: column;
                align-items: stretch;
            }

            .controls {
                flex-direction: column;
                width: 100%;
            }

            .controls input, .controls button {
                width: 100%;
                margin-bottom: 5px;
            }

            .logo {
                right: auto;
                left: calc(100% - 40px); /* 與menu-toggle對稱 */
            }

            .video-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .controls-container {
                flex-direction: row;
                flex-wrap: wrap; /* 允許換行 */
                justify-content: space-between;
            }

            .controls input, .controls button {
                font-size: 10px;
                padding: 2px 4px;
                flex: 1 1 45%; /* 每個按鈕占45%的寬度，允許換行 */
                margin: 2px; /* 增加間距 */
            }

            .controls button {
                width: auto; /* 自動調整寬度 */
                height: 30px;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .controls button i {
                font-size: 16px;
            }

            .controls input[type="text"] {
                width: 100px;
            }

            .logo img {
                height: 20px;
            }
        }

        /* 新增背景動畫 */
        @keyframes backgroundAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .menu-toggle {
            display: none;
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1200;
            cursor: pointer;
            font-size: 24px;
            color: #0055FF;
            transition: background-color 1.5s ease, transform 0.1s ease;
        }

        .menu-toggle:hover {
            background-color: #0055FF;
            color: #1a1a1a;
        }

        .close-menu {
            display: none;
            font-size: 16px;
            color: #1a1a1a !important;
            background-color: #FF3637 !important;
            border: 1px solid #FF3637 !important;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            transition: background-color 1.5s ease, transform 0.1s ease;
        }

        .close-menu:hover {
            background-color: #1a1a1a !important;
            color: #FF3637 !important;
        }

        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }

            .logo {
                right: auto;
                left: calc(100% - 40px); /* 與menu-toggle對稱 */
            }

            .controls-container {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                background: rgba(13, 13, 13, 0.9);
                z-index: 1100;
                flex-direction: column;
                align-items: center;
                padding: 10px;
            }

            .controls-container.active {
                display: flex;
            }

            .close-menu {
                display: block;
                align-self: flex-end;
                margin-right: 10px; /* 確保不超出邊界 */
            }
        }

        .smtv-button {
            background-color: #FFF00D !important;
            color: #1a1a1a !important;
            border: 1px solid #FFF00D !important;
        }

        .smtv-button:hover {
            background-color: #1a1a1a !important;
            color: #FFF00D !important;
        }

        @media (max-width: 768px) {
            .controls {
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 60%;
                margin: 0 auto;
            }

            .controls input, .controls button {
                width: 100%;
                font-size: 12px;
                padding: 5px;
                box-sizing: border-box;
                margin: 5px 0; /* 確保所有按鈕和輸入框有一致的上下間距 */
            }

            .controls input[type="text"] {
                width: 100%;
            }

            .smtv-button, .close-menu {
                width: 100%;
            }
        }

        .controls input[type="number"], .controls input[type="text"] {
            text-align: center;
            color: #cccccc; /* 中等亮度的灰色 */
        }

        .controls input[type="number"]::placeholder, .controls input[type="text"]::placeholder {
            color: #cccccc; /* 中等亮度的灰色 */
        }

        .controls input[type="number"]:focus, .controls input[type="text"]:focus {
            animation: none; /* 聚焦時停止閃爍 */
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="menu-toggle" onclick="toggleMenu()">
        <i class="fas fa-bars"></i> <!-- 確保使用正確的圖標 -->
    </div>
    <div class="controls-container" id="controlsContainer">
        <div class="controls">
            <input type="number" id="videoCount" placeholder="數量" min="1" max="160">
            <input type="text" id="videoUrl" placeholder="YouTube影片網址">
            <button onclick="generateVideos()"><i class="fas fa-video"></i>生成影片</button>
            <button onclick="playAll()"><i class="fas fa-play"></i>播放全部</button>
            <button onclick="pauseAll()"><i class="fas fa-pause"></i>暫停全部</button>
            <button class="smtv-button" onclick="addSMTVVideo()"><i class="fas fa-heart"></i>SMTV</button> <!-- 確認類名 -->
            <button class="close-menu" onclick="toggleMenu()"><i class="fas fa-times"></i> 關閉選單</button>
        </div>
    </div>
    <div class="logo">
        <img src="https://i.imgur.com/S7fBbTw.png" alt="Logo">
    </div>
    <div class="video-container" id="videoContainer"></div>

    <script>
        window.addEventListener('load', () => {
            document.body.style.opacity = '1';
        });

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        var players = [];

        function onYouTubeIframeAPIReady() {
            // 這個函數會在YouTube IFrame API加載完成後被調用
        }

        function extractVideoId(url) {
            const urlObj = new URL(url);
            return urlObj.searchParams.get("v") || urlObj.pathname.split('/').pop();
        }

        function generateVideos() {
            const videoContainer = document.getElementById('videoContainer');
            const videoCount = parseInt(document.getElementById('videoCount').value);
            const videoUrl = document.getElementById('videoUrl').value;
            const videoId = extractVideoId(videoUrl);

            if (videoCount < 1 || videoCount > 160) {
                alert("請輸入1到160之間的數量");
                return;
            }
            if (!videoId) {
                alert("請輸入有效的YouTube影片網址");
                return;
            }

            videoContainer.innerHTML = ''; // 清空現有的影片
            players = []; // 清空現有的播放器

            for (let i = 1; i <= videoCount; i++) {
                const videoWrapper = document.createElement('div');
                videoWrapper.className = 'video-wrapper';
                
                const iframe = document.createElement('iframe');
                iframe.id = `video${i}`;
                iframe.src = `https://www.youtube.com/embed/${videoId}?enablejsapi=1`;
                iframe.frameBorder = "0";
                iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
                iframe.allowFullscreen = true;
                
                videoWrapper.appendChild(iframe);
                videoContainer.appendChild(videoWrapper);

                // 初始化YouTube播放器
                const player = new YT.Player(`video${i}`, {
                    events: {
                        'onReady': (event) => {
                            event.target.setVolume(1); // 設定音量為最低音量1
                            event.target.setPlaybackQuality('small'); // 設定解析度為最低
                        }
                    }
                });
                players.push(player);
            }

            adjustLayout();
        }

        function adjustLayout() {
            const videoContainer = document.getElementById('videoContainer');
            const videoCount = players.length;

            if (videoCount === 0) return;

            const aspectRatio = 16 / 9;
            const containerWidth = videoContainer.clientWidth;
            const containerHeight = videoContainer.clientHeight;
            const containerAspectRatio = containerWidth / containerHeight;

            let cols = Math.ceil(Math.sqrt(videoCount * containerAspectRatio / aspectRatio));
            let rows = Math.ceil(videoCount / cols);

            // 確保有足夠的格子來容納所有影片
            while (cols * rows < videoCount) {
                cols++;
                rows = Math.ceil(videoCount / cols);
            }

            // 設置網格佈局
            videoContainer.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            videoContainer.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
        }

        function playAll() {
            players.forEach(player => player.playVideo());
        }

        function pauseAll() {
            players.forEach(player => player.pauseVideo());
        }

        function addSMTVVideo() {
            const videoContainer = document.getElementById('videoContainer');
            const videoId = 'ZzWBpGwKoaI'; // 固定的影片ID

            const videoWrapper = document.createElement('div');
            videoWrapper.className = 'video-wrapper';

            const iframe = document.createElement('iframe');
            iframe.id = `videoSMTV${players.length}`; // 確保ID唯一
            iframe.src = `https://www.youtube.com/embed/${videoId}?enablejsapi=1`;
            iframe.frameBorder = "0";
            iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
            iframe.allowFullscreen = true;

            videoWrapper.appendChild(iframe);
            videoContainer.appendChild(videoWrapper);

            // 初始化YouTube播放器
            const player = new YT.Player(iframe.id, {
                events: {
                    'onReady': (event) => {
                        event.target.setVolume(1); // 設定音量為最低音量1
                        event.target.setPlaybackQuality('small'); // 設定解析度為最低
                    }
                }
            });
            players.push(player); // 確保播放器被加入到players陣列中

            adjustLayout();
        }

        // 在窗口大小改變時調整佈局
        window.addEventListener('resize', adjustLayout);

        function toggleMenu() {
            const controlsContainer = document.getElementById('controlsContainer');
            controlsContainer.classList.toggle('active');
        }
    </script>
</body>
</html>
